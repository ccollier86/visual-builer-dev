{
	"$id": "https://catalyst/specs/prompt-bundle.meta.schema.json",
	"$schema": "https://json-schema.org/draft/2020-12/schema",
	"title": "Prompt Bundle (Composed Prompt) â€” Meta Schema",
	"type": "object",
	"description": "Validates a composed prompt bundle used to call the LLM with schema-constrained output.",
	"properties": {
		"id": { "type": "string" },
		"templateId": { "type": "string" },
		"templateVersion": { "type": "string" },

		"messages": {
			"type": "array",
			"minItems": 2,
			"items": {
				"type": "object",
				"properties": {
					"role": { "type": "string", "enum": ["system", "user"] },
					"content": { "type": "string", "minLength": 1 }
				},
				"required": ["role", "content"],
				"additionalProperties": false
			}
		},

		"jsonSchema": {
			"type": "object",
			"description": "AIS (AI Structured Output) JSON Schema used for response_format."
		},

		"fieldGuide": {
			"type": "array",
			"description": "One entry per AI field guiding the model.",
			"items": {
				"type": "object",
				"properties": {
					"path": { "type": "string", "minLength": 1 },
					"description": { "type": "string" },
					"guidance": { "type": "array", "items": { "type": "string" } },
					"dependencies": { "type": "array", "items": { "type": "string" } },
					"constraints": {
						"type": "object",
						"properties": {
							"enum": { "type": "array", "items": { "type": "string" } },
							"pattern": { "type": "string" },
							"x-minWords": { "type": "integer", "minimum": 0 },
							"x-maxWords": { "type": "integer", "minimum": 1 },
							"x-minSentences": { "type": "integer", "minimum": 0 },
							"x-maxSentences": { "type": "integer", "minimum": 1 }
						},
						"additionalProperties": true
					},
					"style": { "type": "object", "additionalProperties": true }
				},
				"required": ["path"]
			}
		},

		"context": {
			"type": "object",
			"description": "Slimmed runtime context actually injected into the prompt.",
			"properties": {
				"factPack": { "type": "object" },
				"nasSlices": { "type": "object" }
			},
			"additionalProperties": false
		}
	},

	"required": ["messages", "jsonSchema"],
	"additionalProperties": false
}
